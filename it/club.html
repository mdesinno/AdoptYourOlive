<!DOCTYPE html>
<html lang="it"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Adopt Your Olive | Your Name. Your Oil. Your Story.</title>
    <meta name="description" content="Adopt a centuries-old olive tree in Puglia, Italy. Receive your personalized Extra Virgin Olive Oil immediately. A perfect gift directly from the farm.">

    <link rel="alternate" hreflang="en" href="https://adoptyourolive.com/" />
    <link rel="alternate" hreflang="it" href="https://adoptyourolive.com/it/" />
    <link rel="alternate" hreflang="x-default" href="https://adoptyourolive.com/" />
    <link rel="canonical" href="https://adoptyourolive.com/" />

    <meta name="google-site-verification" content="Y85AARKVRz6ltP7evzrwVD9khwUHW-t15SLTXBLH_Os" />

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="/style.css">
    <script src="/script.js" defer></script>

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://adoptyourolive.com/">
    <meta property="og:title" content="Adopt Your Olive | Your Name. Your Oil. Your Story.">
    <meta property="og:description" content="Adopt a tree, receive premium EVOO oil with your name. Support traditional farming in Puglia.">
    <meta property="og:image" content="https://adoptyourolive.com/immagini/Albero-hero.webp">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Adopt Your Olive | Your Name. Your Oil. Your Story.">
    <meta name="twitter:description" content="Adopt a tree, receive premium oil. The perfect gift for food lovers.">
    <meta name="twitter:image" content="https://adoptyourolive.com/immagini/Albero-hero.webp">
    <script>
  // Definisce la lingua globale per tutti gli script del sito
  window.currentLang = document.documentElement.lang || (window.location.pathname.includes('/it/') ? 'it' : 'en');
</script>
</head>
<body>
<main class="club-page-wrapper">

    <nav class="navbar">
        <div class="container nav-content">
            <a href="/" class="logo-wrapper">
                <img src="/immagini/logo.webp" alt="AYO Logo" class="logo-img">
            </a>
            
            <div class="nav-links">
                <a href="/it/club.html#member-perk">Regala un'adozione</a>
                <a href="/it/club.html#guide-recipes">Guida alla degustazione</a>
                <a href="/it/club.html#find-tree">Trova il tuo albero</a>

                <!--<a href="#adoption-kits">Shop</a>
                
                <a href="#" onclick="openCorporateModal(); return false;">Corporate & Weddings</a>-->
                
                <a href="/club.html" onclick="sessionStorage.setItem('force_en', 'true')"; class="shipping-alert">
    <span>üá¨üáß English</span>
</a>
            </div>
            
            <div class="mobile-menu-icon">‚ò∞</div>
        </div>
    </nav>

    <header class="club-hero">
    <div class="hero-content">
        <span class="eyebrow">Adopters Club</span>
        <h1>Benvenuto in Famiglia.</h1>
        <p>Il certificato √® la tua chiave d'accesso. Ora entra nel vivo.</p>
    </div>
</header>

<div class="club-container">

    <section id="member-perk" class="club-card dark-mode">
        <div class="ribbon">SOLO PER TE</div>
        <div class="card-text">
            <h2>Porta un amico tra gli ulivi</h2>
            <p>L'olio buono non si tiene per s√©. Se regali un'adozione a una persona cara, facciamo un regalo a entrambi.</p>
            <ul class="benefit-list">
                <li>üéÅ <strong>Per il tuo Amico:</strong> Una sorpresa extra nel pacco.</li>
                <li>üíé <strong>Per Te:</strong> Uno sconto speciale sul prossimo rinnovo.</li>
            </ul>
        </div>
        
        <button onclick="openGiftModal()" class="btn-club light">
            Fai un Regalo
        </button>
    </section>

    <section id="guide-recipes" class="club-card">
        <div class="card-icon">üìñ</div>
        <div class="card-text">
            <h2>Impara a gustarlo</h2>
            <p>Non √® solo olio. Scarica il manuale di assaggio e i nostri ricettari segreti.</p>
        </div>
        
        <form id="guideForm" class="club-form">
            <input type="hidden" name="lang" id="guideLang" value="it">
            <div style="display:none !important; visibility:hidden !important;" aria-hidden="true">
    <input type="text" name="fax_number" tabindex="-1" autocomplete="off">
</div>
            <div class="input-group">
                <input type="text" name="MEMBER_ID" placeholder="Il tuo Member ID (es. M-24-88)" required>
            </div>
            <div class="input-group">
                <input type="email" name="EMAIL" placeholder="La tua Email" required>
            </div>
            
            <button type="submit" class="btn-club primary">Inviami le Guide</button>
        </form>
        
        <p id="guideSuccessMsg" class="tiny-note" style="display:none; color: green;"></p>
    </section>

    <section id="find-tree" class="club-card highlight-border">
        <div class="card-header-row">
            <div class="card-icon">üõ∞Ô∏è</div>
            <h2>Vola sul tuo Albero</h2>
        </div>
        <p>Vuoi vedere dove cresce il tuo olio? Inserisci il codice e ti ci portiamo via satellite.</p>
        
        <div class="input-group">
            <input type="text" id="treeSearchInput" placeholder="Es: IT-PUG-1234">
        </div>

        <p id="searchFeedback" style="display:none; font-size: 0.8rem; color: #666; margin-bottom: 10px;">Controllo le coordinate...</p>

        <button onclick="findTreeFromSheet()" class="btn-club outline">
            Localizza l'Uliveto
        </button>
        
        <p class="tiny-note">Non trovi il codice? Guarda sul certificato o scrivici.</p>
    </section>

</div>

</main>

<section id="partners" class="section-padded bg-white" style="border-top: 1px solid #eee;">
    <div class="container">
        
        <div class="section-header text-center" style="margin-bottom: 30px;">
            <span class="eyebrow">La Nostra Filiera Corta</span>
            <h3 style="font-size: 1.5rem;">Realizzato con Amici e Famiglia</h3>
        </div>
        
        <div class="slider-wrapper" id="partners-slider">
            <button class="slider-btn prev-btn">‚ùÆ</button>
            
            <div class="slider-track-container">
                <ul class="slider-track">
                    
                    <li class="slide partner-slide">
                        <a  target="_blank">
                            <img src="/immagini/Donna-Lisa-logo-desktop.webp" alt="Partner 1">
                        </a>
                    </li>

                    <li class="slide partner-slide">
                        <a target="_blank">
                            <img src="/immagini/Parente-logo.webp" alt="Partner 2">
                        </a>
                    </li>

                    <li class="slide partner-slide">
                        <a  target="_blank">
                            <img src="/immagini/Feudo-Massari-logo.webp" alt="Partner 3">
                        </a>
                    </li>

                    <li class="slide partner-slide">
                        <a  target="_blank">
                            <img src="/immagini/Cinzia-olearia-logo.webp" alt="Partner 4">
                        </a>
                    </li>

                </ul>
            </div>

            <button class="slider-btn next-btn">‚ùØ</button>
        </div>
    </div>
</section>

    <section id="contacts" class="section-padded bg-dark text-white">
        <div class="container">
            <div class="contacts-wrapper">
                
                <div class="contact-form-col">
                    <h3>Contattaci</h3>
                    <p class="mb-20">Domande? Ordini su misura? Scrivici.</p>
                    
                    <form id="contact-form" class="contact-form">
                        <input type="hidden" name="lang" value="it">
<div style="display:none !important; visibility:hidden !important;" aria-hidden="true">
    <input type="text" name="fax_number" tabindex="-1" autocomplete="off">
</div>
                        <div class="form-group">
                            <input type="text" name="name" placeholder="Il Tuo Nome" required class="input-dark">
                        </div>
    
                        <div class="form-group">
                            <input type="email" name="email" placeholder="La Tua Email" required class="input-dark">
                        </div>
    
                        <div class="form-group">
                            <textarea name="message" rows="3" placeholder="Come possiamo aiutarti?" required class="input-dark"></textarea>
                        </div>

                        <p style="font-size: 0.75rem; color: #888; margin-bottom: 15px; line-height: 1.4;">
                            Cliccando qui sotto, accetti la nostra <a href="privacy-policy.html" style="text-decoration: underline; color: #888;">Privacy Policy</a>.
                        </p>

                        <button type="submit" id="contact-btn" class="btn-primary">Invia Messaggio</button>
                    </form>
                </div>

                <div class="newsletter-col">
                    <div class="newsletter-box">
                        <h3>Unisciti alla Famiglia</h3>
                        <p>Ricevi aggiornamenti sul raccolto, ricette e offerte esclusive.</p>
                        
                        <form id="newsletter-form" class="newsletter-form">
                            <input type="hidden" name="lang" value="it">
        <div style="display:none !important; visibility:hidden !important;" aria-hidden="true">
    <input type="text" name="fax_number" tabindex="-1" autocomplete="off">
</div>
                            <div class="newsletter-input-group">
                                <input type="email" name="email" placeholder="nome@esempio.com" required class="input-dark">
                                <button type="submit" class="btn-primary" id="newsletter-btn">Iscriviti</button>
                            </div>

                            <div class="privacy-check">
                                <input type="checkbox" id="priv-news" name="privacy" required>
                                <label for="priv-news">
                                    Ho letto e accetto la <a href="privacy-policy.html" style="text-decoration:underline;">Privacy Policy</a>
                                </label>
                            </div>
        
                            <p id="newsletter-feedback" style="display:none; margin-top:10px; font-size:0.9rem;"></p>
                        </form>
                    </div>
                </div>
                
            </div>
        </div>
    </section>

    <footer class="site-footer bg-dark text-white">
        <div class="container footer-content">
            <div class="footer-col">
                <span class="logo-text">AYO.</span>
                <p>Il tuo Albero. Il tuo Olio. La tua Storia.</p>
            </div>
            
            <div class="footer-col">
                <h4>Link</h4>
                <ul>
                    <li><a href="#home">Home</a></li>
                    <li><a href="#adoption-kits">Adotta</a></li>
                    <!--<li><button onclick="openCorporateModal()" class="text-link" style="background:none; border:none; color:#999; cursor:pointer; padding:0; font-family:inherit; font-size:inherit;">Matrimoni & Eventi</button></li>
                    <li><a href="/shop.html">Shop</a></li>-->
                    </ul>
            </div>

            <div class="footer-col">
                <h4>Legale</h4>
                <ul>
                    <li><a href="privacy-policy.html">Privacy Policy</a></li>
                    <li><a href="cookie-policy.html">Cookie Policy</a></li>
                    <li><a href="terms-of-service.html">Termini e Condizioni</a></li>
                    <li><a href="shipping-returns.html">Spedizioni e Resi</a></li>
                </ul>
            </div>
            
            <div class="footer-col">
                <h4>Contatti</h4>
                <p>San Severo, Puglia (IT)</p>
                <p><a href="mailto:info@adoptyourolive.com">info@adoptyourolive.com</a></p>
                <div class="social-links" style="margin-top:10px;">
                    <a href="https://instagram.com/adoptyourolive" target="_blank" aria-label="Instagram">
                        <i class="fab fa-instagram"></i> IG
                    </a>
                    <a href="https://wa.me/390882606222" target="_blank" aria-label="WhatsApp">
                        <i class="fab fa-whatsapp"></i> WA
                    </a>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom text-center">
            <p>&copy; 2026 Adopt Your Olive. Tutti i diritti riservati.</p>
        </div>
    </footer>


<div id="giftModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 550px; text-align: left;">
        <span class="close-modal" onclick="closeGiftModal()">√ó</span>
        
        <h3 style="text-align: center; color: var(--primary-green); margin-bottom: 5px;">Regala un'Adozione</h3>
        <p style="text-align: center; margin-bottom: 25px; font-size: 0.9rem; color: #666;">
            Attiva il <strong>Referral Bonus</strong> per te e per il tuo amico.
        </p>
        
        <form id="referralCheckoutForm" onsubmit="handleReferralCheckout(event)">
            <input type="hidden" name="lang" value="it">
            <div style="display:none !important; visibility:hidden !important;" aria-hidden="true">
    <input type="text" name="fax_number" tabindex="-1" autocomplete="off">
</div>
            <div class="input-group">
                <label style="font-weight: bold; font-size: 0.9rem;">1. Scegli il Kit</label>
                <select id="kitSelect" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-top: 5px; background: #fff;">
                    <option value="" disabled selected>-- Seleziona --</option>
                    <option value="welcome-kit">üéÅ Welcome Kit (1L) - 49‚Ç¨ (Italia)</option>
                    <option value="reserve-kit">‚ù§Ô∏è Reserve Kit (2L) - 79‚Ç¨ (Italia)</option>
                    <option value="family-kit">üë®‚Äçüë©‚Äçüëß Family Kit (5L) - 129‚Ç¨ (Italia)</option>
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                <div>
                    <label style="font-size: 0.8rem;">Il tuo Nome</label>
                    <input type="text" name="buyerFirstName" placeholder="Mario" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                <div>
                    <label style="font-size: 0.8rem;">Il tuo Cognome</label>
                    <input type="text" name="buyerLastName" placeholder="Rossi" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
            </div>
            <div style="margin-top: 10px;">
                <label style="font-size: 0.8rem;">La tua Email</label>
                <input type="email" name="email" placeholder="mario@email.com" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            </div>

            <hr style="border:0; border-top: 1px dashed #ddd; margin: 20px 0;">

            <div style="background: #f9f9f9; padding: 15px; border-radius: 8px;">
                <p style="margin: 0 0 10px 0; font-weight: bold; font-size: 0.9rem;">2. Dati del Regalo</p>
                
                <div style="margin-bottom: 10px;">
                    <label style="font-size: 0.8rem;">Nome sul Certificato</label>
                    <input type="text" name="certName" placeholder="Luigi Bianchi" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>

                <div style="margin-bottom: 10px;">
                    <label style="font-size: 0.8rem;">Nome sull'Etichetta</label>
                    <div style="display: flex; align-items: center;">
                        <span style="background: #e9e9e9; padding: 10px; border: 1px solid #ddd; border-right: 0; border-radius: 6px 0 0 6px; font-size: 0.9rem;">Olio</span>
                        <input type="text" name="labelName" placeholder="Bianchi" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 0 6px 6px 0;">
                    </div>
                </div>

                <div>
                    <label style="font-size: 0.8rem;">Messaggio di Auguri</label>
                    <textarea name="giftMessage" rows="2" placeholder="Tanti auguri Luigi!..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"></textarea>
                </div>
            </div>

            <div style="margin-top: 20px; background: #e8f5e9; padding: 15px; border-radius: 8px; border: 1px solid #2c5e2e;">
                <label style="font-weight: bold; color: #2c5e2e; display: block; margin-bottom: 5px;">
                    Member ID (Codice Amico)
                </label>
                <input type="text" id="referralInput" name="memberId" placeholder="Es: M-2024-88" required 
                       style="width: 100%; padding: 12px; border: 2px solid #2c5e2e; border-radius: 6px; font-weight: bold;">
                <small style="color: #2c5e2e;">Inserisci il tuo codice per attivare i bonus.</small>
            </div>

            <div class="modal-actions" style="margin-top: 25px;">
                <button type="submit" class="btn-club primary" style="width: 100%; padding: 15px; font-size: 1.1rem;">
                    Vai al Pagamento Sicuro &rarr;
                </button>
            </div>
            <p class="tiny-note" style="text-align: center; margin-top: 10px;">
                üîí Pagamento gestito da Stripe. Spedizione richiesta al passaggio successivo.
            </p>
        </form>
    </div>
</div>

    <dialog id="corporate-modal" class="modal modal-wide">
    <div class="modal-box modal-split-layout">
        
        <div class="modal-visual">
            <img src="../immagini/Foto-bottiglie-certificato.webp" alt="Bomboniera Olio Puglia" class="modal-img-cover">
        </div>

        <div class="modal-form-content">
            <button class="close-modal" onclick="closeCorporateModal()">‚úï</button>

            <div class="modal-header">
                <h3>Matrimoni & Eventi</h3>
                <p class="modal-subtitle">Richiedi un preventivo personalizzato per il tuo giorno speciale.</p>
            </div>

            <div class="kit-info-box">
                <strong>La Bomboniera Gourmet include:</strong>
                <ul class="kit-list-inline">
                    <li>ü´í Bottiglia 500ml</li>
                    <li>üè∑Ô∏è Etichetta Evento</li>
                    <li>üìú Mini-Certificato</li>
                </ul>
            </div>
            
            <form id="corporate-form">
                <input type="hidden" name="lang" value="it">
<div style="display:none !important; visibility:hidden !important;" aria-hidden="true">
    <input type="text" name="fax_number" tabindex="-1" autocomplete="off">
</div>
                <div class="form-group">
                    <label>Nome o Agenzia:</label>
                    <input type="text" name="name" placeholder="es. Marco & Giulia" required>
                </div>

                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" name="email" placeholder="nome@email.com" required>
                </div>

                <div class="form-row">
                    <div class="form-group half-width">
                        <label>Tipo Evento:</label>
                        <input type="text" name="eventType" placeholder="Matrimonio..." required>
                    </div>
                    <div class="form-group half-width">
                        <label>Quantit√† stimata:</label>
                        <input type="number" name="quantity" placeholder="es. 50" min="10" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Note (Data, Luogo):</label>
                    <textarea name="message" rows="2" placeholder="Raccontaci del tuo evento..."></textarea>
                </div>

                <p style="font-size: 0.75rem; color: #888; margin-bottom: 15px; text-align: center;">
                    Cliccando qui sotto, accetti la nostra <a href="privacy-policy.html" style="text-decoration: underline; color: #888;">Privacy Policy</a>.
                </p>

                <button type="submit" id="corp-btn" class="btn-primary btn-full">Richiedi Preventivo</button>
            </form>
        </div>
    </div>
</dialog>

    <div id="cookie-banner" class="cookie-banner" style="display: none;">
        <div class="cookie-content">
            <h3>Teniamo alla tua privacy üç™</h3>
            <p>Utilizziamo i cookie per migliorare la tua esperienza, fornire contenuti personalizzati e analizzare il traffico. Puoi scegliere di accettare tutto o personalizzare.</p>
        </div>
        <div class="cookie-actions">
            <button id="cookie-customize" class="btn-link">Personalizza</button>
            <button id="cookie-reject" class="btn-outline-light">Rifiuta Tutti</button>
            <button id="cookie-accept" class="btn-primary">Accetta Tutti</button>
        </div>
    </div>

    <dialog id="cookie-modal" class="modal">
        <div class="modal-box">
            <button class="close-modal" onclick="closeCookieModal()">‚úï</button>
            <div class="modal-header">
                <h3>Preferenze Cookie</h3>
                <p>Gestisci le impostazioni del consenso.</p>
            </div>
            
            <form id="cookie-form">
                <div class="cookie-option">
                    <div class="cookie-info">
                        <strong>Strettamente Necessari</strong>
                        <p>Essenziali per il funzionamento del sito (es. carrello, login). Non possono essere disabilitati.</p>
                    </div>
                    <div class="cookie-toggle">
                        <input type="checkbox" checked disabled>
                        <span class="slider locked"></span>
                    </div>
                </div>

                <div class="cookie-option">
                    <div class="cookie-info">
                        <strong>Analisi & Prestazioni</strong>
                        <p>Ci aiutano a capire come usi il sito per migliorarlo.</p>
                    </div>
                    <div class="cookie-toggle">
                        <input type="checkbox" id="consent-analytics" name="analytics">
                        <label for="consent-analytics" class="slider"></label>
                    </div>
                </div>

                <div class="cookie-option">
                    <div class="cookie-info">
                        <strong>Marketing</strong>
                        <p>Usati per mostrare annunci pertinenti e tracciare le campagne.</p>
                    </div>
                    <div class="cookie-toggle">
                        <input type="checkbox" id="consent-marketing" name="marketing">
                        <label for="consent-marketing" class="slider"></label>
                    </div>
                </div>

                <button type="button" id="save-preferences" class="btn-primary btn-full" style="margin-top: 20px;">Salva Preferenze</button>
            </form>
        </div>
    </dialog>

    <script>
    // ==========================================
    // 1. GESTIONE INVIO GUIDE (Chiama la nuova Netlify Function)
    // ==========================================
    // --- 3. GESTIONE GUIDE (Nuova logica ID + Email) ---
    async function handleGuideSubmit(e) {
        e.preventDefault();
        const btn = e.target.querySelector('button');
        const feedback = document.getElementById('guideSuccessMsg');
        
        // Raccogli dati
        const formData = new FormData(e.target);
        // Nota: name="MEMBER_ID" e name="EMAIL" devono corrispondere all'HTML
        const memberId = formData.get('MEMBER_ID');
        const email = formData.get('EMAIL');
        
        // UI Loading
        const originalText = btn.innerText;
        btn.innerText = "Processing..."; 
        btn.disabled = true;

        try {
            const res = await fetch('/.netlify/functions/send-guide', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    memberId: memberId, 
                    email: email,
                    lang: currentLang 
                })
            });
            
            const result = await res.json();

            if(res.ok) {
                btn.innerText = "OK!";
                btn.style.backgroundColor = "#2c5e2e";
                
                // Messaggio personalizzato in base alla lingua
                const msg = currentLang === 'it' 
                    ? "Guide inviate! Controlla la posta." 
                    : "Guides sent! Check your inbox.";
                
                feedback.innerText = msg;
                feedback.style.display = 'block';
                feedback.style.color = 'green';
                e.target.reset();
            } else {
                throw new Error(result.error);
            }
        } catch(err) {
            console.error(err);
            btn.innerText = "Error";
            btn.style.backgroundColor = "#d9534f";
            feedback.innerText = "Error: " + err.message;
            feedback.style.display = 'block';
            feedback.style.color = 'red';
        }
        
        // Ripristina dopo 3 sec
        setTimeout(() => { 
            btn.disabled = false; 
            btn.style.backgroundColor = ""; // Reset colore
            btn.innerText = originalText; // Usa il testo originale tradotto o no
        }, 3000);
    }
    
    document.getElementById('guideForm').addEventListener('submit', handleGuideSubmit);


    // ==========================================
    // 2. LOCALIZZATORE ALBERI (GOOGLE SHEET CSV)
    // ==========================================
    
    // INCOLLA QUI IL LINK DEL TUO CSV (Step 2)
    const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQKcyCBJZcBzwjodQngZENkDY0hh66TOL3Ti7pbYWqeaLDkFa3Gd3Y2qLKd6C5DqzshWlNlQUtjPASz/pub?gid=1326004231&single=true&output=csv'; 

   async function findTreeFromSheet() {
        const inputID = document.getElementById('treeSearchInput').value.trim().toUpperCase();
        const feedback = document.getElementById('searchFeedback');
        
        if (!inputID) {
            alert("Inserisci un Codice Albero valido.");
            return;
        }

        feedback.style.display = 'block';
        feedback.innerText = "Ricerca nel database...";

        try {
            const response = await fetch(SHEET_CSV_URL);
            const data = await response.text();

            // Legge il CSV riga per riga
            const rows = data.split('\n');
            let foundCoords = null;

            for (let row of rows) {
                const cols = row.split(','); 
                if (cols.length >= 2) {
                    // Pulisce l'ID (rimuove spazi e virgolette)
                    const dbID = cols[0].trim().toUpperCase().replace(/["']/g, ''); 
                    
                    if (dbID === inputID) {
                        // TROVATO! 
                        foundCoords = cols[1].trim().replace(/["']/g, '');
                        // Se c'√® una terza colonna (es: Lat, Long separate), uniscile
                        if (!foundCoords.includes(',') && cols[2]) {
                             foundCoords += ',' + cols[2].trim().replace(/["']/g, '');
                        }
                        break;
                    }
                }
            }

            feedback.style.display = 'none';

            if (foundCoords) {
                // APRE GOOGLE MAPS (Zoom massimo 21 + Satellite)
                const mapsUrl = `https://www.google.com/maps?q=${encodeURIComponent(foundCoords)}&z=21&t=k`;
                window.open(mapsUrl, '_blank');
            } else {
                // Messaggio diverso in base alla lingua (se hai implementato il multilingua)
                const msg = (typeof currentLang !== 'undefined' && currentLang === 'en') 
                    ? "Code not found. Please check your certificate." 
                    : "Codice non trovato. Controlla di averlo scritto bene.";
                alert(msg);
            }

        } catch (error) {
            console.error(error);
            feedback.style.display = 'none';
            alert("Impossibile connettersi al database alberi.");
        }
    }

    // Seleziona l'input
const searchInput = document.getElementById('treeSearchInput');

// Aggiungi l'evento
if (searchInput) {
    searchInput.addEventListener("keypress", function(event) {
        // Se il tasto premuto √® "Enter" (Invio)
        if (event.key === "Enter") {
            event.preventDefault(); // Evita refresh della pagina
            findTreeFromSheet();    // Lancia la tua funzione di ricerca
        }
    });
}

    // --- 1. GESTIONE APERTURA/CHIUSURA MODALE ---
    const giftModal = document.getElementById('giftModal');
    
    function openGiftModal() { 
        giftModal.style.display = 'flex'; 
        // Precompila se c'√® un ID salvato
        const savedID = localStorage.getItem('ayo_referrer');
        if(savedID) document.getElementById('referralInput').value = savedID;
    }
    
    function closeGiftModal() { giftModal.style.display = 'none'; }
    window.onclick = function(e) { if (e.target == giftModal) closeGiftModal(); }

    // --- 2. LOGICA DI CHECKOUT (Chiama la tua function checkout.js) ---
    async function handleReferralCheckout(e) {
        e.preventDefault();
        
        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.innerText;
        btn.innerText = "Caricamento...";
        btn.disabled = true;

        const formData = new FormData(e.target);
        
        // Costruiamo l'oggetto dati ESATTAMENTE come lo vuole checkout.js
        const data = {
            kitId: document.getElementById('kitSelect').value,
            buyerFirstName: formData.get('buyerFirstName'),
            buyerLastName: formData.get('buyerLastName'),
            email: formData.get('email'),
            lang: typeof currentLang !== 'undefined' ? currentLang : 'it', // Usa la variabile globale lingua
            
            // Dati Regalo (Questa modale √® SEMPRE un regalo)
            isGift: true,
            giftMessage: formData.get('giftMessage'),
            
            // Dati Prodotto
            certName: formData.get('certName'),
            labelName: formData.get('labelName'),
            
            // REFERRAL (Fondamentale)
            memberId: formData.get('memberId'),
            
            // Niente codice sconto
            discountCode: '' 
        };

        try {
            const response = await fetch('/.netlify/functions/checkout', {
                method: 'POST',
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' }
            });

            const result = await response.json();

            if (response.ok) {
                // Redirect a Stripe
                window.location.href = result.url;
            } else {
                throw new Error(result.error || "Errore sconosciuto");
            }

        } catch (error) {
            console.error(error);
            alert("Errore nel checkout: " + error.message);
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }
</script>

    </body>